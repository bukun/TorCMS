<script>
    function tjstate(sid) {

        var url = "/api/post/submit_state/{{postinfo.uid}}/" + sid;

        var recstate = document.getElementById("recstate");


        $.ajax({
            type: 'POST',
            url: url,
            success: function (rs) {
                var m = eval("(" + rs + ")");

                if (m.state == 'start') {
                    recstate.innerHTML = '<strong>{{ _('Audit status') }}:</strong> <span>{{ _('To be reviewed') }} <a class="btn btn-warning btn-xs"  onclick="tjstate(\'cancelled\')">{{  _("cancelled")  }}</a>&nbsp'

                }else{
                    recstate.innerHTML = '<a href="/{{ kwd.get('router') }}/_edit/{{ postinfo.uid }}" class="btn btn-warning btn-xs">Edit</a> <a class="btn btn-danger btn-xs" onclick="tjstate(\'start\')">{{  _("Submit for review")  }}</a>'
                }
            },
            error: function (err) {
                alert('Submission failed');
            }
        });

    }


</script>

<div class="col-sm-12">

    {% if userinfo %}

    <div id="recstate" class="col-sm-7" >

        {% if userinfo.user_name == postinfo.user_name %}

                <a href="/{{ kwd.get('router') }}/_edit/{{ postinfo.uid }}" class="btn btn-warning btn-xs">{{ _('Edit') }}</a>
                <a class="btn btn-danger btn-xs" onclick="tjstate('start')">{{  _("Submit for review")  }}</a>

        {% else %}
            {% if postinfo.state[1] == '0' %}
               <strong>{{ _('Audit status') }}:</strong> <span>{{  _("Waiting for review")  }} </span>

            {% end %}
        {% end %}


    </div>

{% for action in action_arr %}
<a class="btn btn-primary btn-sm" onclick="tjaction('start')">{{ str(action)[:-6] }}</a>
    {% end %}
    {% end %}
</div>