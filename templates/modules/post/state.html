<script>
    function tjstate(pro_id, state_id) {

        var url = "/api/post/submit_state/{{postinfo.uid}}/" + pro_id + "/" + state_id;

        var recstate = document.getElementById("recstate");


        $.ajax({
            type: 'POST',
            url: url,
            success: function (rs) {
                var m = eval("(" + rs + ")");
                var btn_arr = ''
                for (var act in m.act_recs) {
                    btn_arr += '<a class="btn btn-warning btn-xs"  onclick="tjaction(' +
                        m.act_recs[act]['act_uid'] + ',' + m.act_recs[act]['state'] + ')">' + m.act_recs[act]['act_name'] + '</a>&nbsp'
                }
                recstate.innerHTML = btn_arr
            },
            error: function (err) {
                alert('Submission failed');
            }
        });

    }


</script>

<div class="col-sm-12">

    {% if userinfo %}
    {% if action_arr %}
    {% for action in action_arr %}
    <a class="btn btn-warning btn-sm" onclick="tjaction('start')">{{ str(action)[:-6] }}</a>
    {% end %}
    {% else %}

    <div id="recstate" class="col-sm-7">

        {% if userinfo.user_name == postinfo.user_name %}

        <a href="/{{ kwd.get('router') }}/_edit/{{ postinfo.uid }}" class="btn btn-warning btn-xs">{{ _('Edit') }}</a>
        <a class="btn btn-danger btn-xs"
           onclick="tjstate('6e6bbc82-d9f5-11ed-a7ca-1183026cd4c2','6e6bbc83-d9f5-11ed-a7ca-1183026cd4c2')">{{ _("Submit for review") }}</a>

        {% else %}
        {% if postinfo.state[1] == '0' %}
        <strong>{{ _('Audit status') }}:</strong> <span>{{ _("Waiting for review") }} </span>

        {% end %}
        {% end %}


    </div>


    {% end %}
    {% end %}
</div>