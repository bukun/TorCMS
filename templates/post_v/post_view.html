{% extends "../theme/bage_add_edit.html" %}
{% block head %}
<title>{{ postinfo.title }} | {{ _('Online map') }}</title>
<meta name="keywords" content="{% for x in tag_info %} {{ _(x.tag_name) }} {% end %},{{ postinfo.title }}">
<meta name="description" content="{% module generate_abstract(postinfo.cnt_html) %},{{ postinfo.title }}">


<link rel="stylesheet" href="{{ static_url('f2elib/bootstrap-star-rating-master/css/star-rating.css') }}"
      type="text/css"
      media="all">
<script type="text/javascript" src="{{ static_url('f2elib/bootstrap-star-rating-master/js/star-rating.js') }}"></script>


<script type="text/javascript" src="/static/maplet/bootstrap-sphinx.js"></script>
<script>
    var post_uid = "{{postinfo.uid}}";
    var login = {{kwd['login']}};
</script>

<script>
    $(document).ready(function () {

        var uu = document.getElementById('map_kd1');
        var map_kd1 = L.map('map_kd1', {
            maxZoom: uu.dataset.max,
            minZoom: uu.dataset.min,
            center: [uu.dataset.x,uu.dataset.y],
            zoom: uu.dataset.cur
        });


      var basemap_kd1 = L.tileLayer.chinaProvider('TianDiTu.Normal.Map', {
                maxZoom: 12,
                attribution: '',
                id: "mapbox.satellite",

            });
            basemap_kd1.addTo(map_kd1);





        var kd1_0131 = L.tileLayer.wms('https://tile.osgeo.cn/service', {
            layers: uu.dataset.maplet,
            format: 'image/png',
            transparent: true
        }).addTo(map_kd1);

        var title = uu.dataset.title;



      // var baseLayers = {
      //   "底图": basemap_kd1,
      //
      // };

      var overlayMaps_kd1 = new Array();
      overlayMaps_kd1[title] = kd1_0131;

      // L.control.layers(baseLayers, overlayMaps_kd1).addTo(map_kd1);
      L.control.layers( overlayMaps_kd1).addTo(map_kd1);

      	const popup = L.popup();

      	function onMapClick(e) {
		popup
			.setLatLng(e.latlng)
			.setContent(`You clicked the map at ${e.latlng.toString()}`)
			.openOn(map_kd1);
	}

	map_kd1.on('click', onMapClick);


    });
</script>

<style>
    #map_kd1 {
        width: 100%;
        height: 400px;
    }
</style>
{% block headinfo %}
{% end %}
{% end %}
{% block zhuti %}


<div class="mtop">
    <ul class="breadcrumb">
        <li>Current location: <a href="/" title="Home">{{ _('Home') }} </a></li>
          <li><a href="/{{router}}/" title="{{post_type}}">{{post_type}}</a></li>
        <li>{% module the_category(postinfo.uid) %}</li>
        <li>{{ _('Text') }}</li>
    </ul>
</div>

<div class="panel panel-black">

    <div class="panel-heading listinfo_title">
        <h1 class="news-title">{{ postinfo.title }}</h1>
    </div>
    <div class="panel-body">
        <div class="row">
            <div class="col-md-12 bor_bottom">

                <div class="col-md-12">

                    <div style="float: left">
                        <b>{{ _('Date') }}:</b>
                        {{ datetime.datetime.fromtimestamp(postinfo.time_update).strftime('%Y-%m-%d') }}&nbsp;
                      &nbsp;&nbsp;
                    </div>

                    {% if userinfo %}
                    <span class="pull-right">

                        {% module widget_editor('map-show', postinfo.uid, userinfo,kind = postinfo.kind) %}

                    {% module collect(userinfo.uid, postinfo.uid, en=True) %}
                              </span>
                    {% end %}

                </div>

                <div class="col-sm-12">


                </div>
                <div class="col-md-12"><Br><b>{{ _('Category') }}:</b> <span
                        class="post_cat">{% module post_catalogs(postinfo.uid,postinfo.kind) %}</span>
                </div>
            </div>
        </div>
        <br>
           <div id="map_kd1" data-maplet="{{ postinfo.extinfo['ext_data-maplet'] }}" data-title="{{postinfo.title}}"
             data-x="{{ postinfo.extinfo['ext_lat'] }}" data-y="{{ postinfo.extinfo['ext_lon'] }}" data-cur="{{ postinfo.extinfo['ext_zoom_current'] }}"
             data-min="{{ postinfo.extinfo['ext_zoom_min'] }}" data-max={{ postinfo.extinfo['ext_zoom_max'] }}></div>


        <br>
<div class="col-sm-12 bor_bottom">
                <br>
            <h4 class="list-group-item-heading">{{ _('Map description') }} </h4>
        </div>

        <div class="col-sm-12 bor_bottom">
     <br>
            <div id="wiki_cnt" class="listinfo_content">
                {% raw unescape(postinfo.cnt_html) %}
            </div>
        </div>
        <div class="col-sm-12 bor_bottom">
            <div class="col-sm-8">
            <div id="iga_view_rec_box">

                <div class="row">
                    <div class="col-sm-4">
                    <span class="des">
        <strong>{{ _('Central point longitude') }} </strong>
    </span>
                    </div>
                    <div class="col-sm-8">
                        {{ str(postinfo.extinfo.get('ext_lon')).split('.')[0] + '.' + str(postinfo.extinfo.get('ext_lon')).split('.')[1][:3]  }}
                    </div>
                </div>

                <div class="row">
                    <div class="col-sm-4">
                    <span class="des">
        <strong>{{ _('Central point latitude') }} </strong>
    </span>
                    </div>
                    <div class="col-sm-8">
                         {{ str(postinfo.extinfo.get('ext_lat')).split('.')[0] + '.' + str(postinfo.extinfo.get('ext_lat')).split('.')[1][:3]  }}

                    </div>
                </div>

                <div class="row">
                    <div class="col-sm-4">
                    <span class="des">
        <strong>{{ _('Max zoom level') }} </strong>
    </span>
                    </div>
                    <div class="col-sm-8">
                        {{ postinfo.extinfo.get('ext_zoom_max') }}
                    </div>
                </div>

                <div class="row">
                    <div class="col-sm-4">
                    <span class="des">
        <strong>{{ _('Min zoom level') }} </strong>
    </span>
                    </div>
                    <div class="col-sm-8">
                         {{ postinfo.extinfo.get('ext_zoom_min') }}
                    </div>
                </div>

                <div class="row">
                    <div class="col-sm-4">
                    <span class="des">
        <strong>{{ _('Current zoom level') }} </strong>
    </span>
                    </div>
                    <div class="col-sm-8">
                       {{ postinfo.extinfo.get('ext_zoom_current') }}
                    </div>
                </div>

            </div>
                </div>
            <div class="col-sm-4">

                <img src="/static/map_legend/xx_{{ postinfo.extinfo['ext_data-maplet'] }}.png" class="img-thumbnail">
            </div>
        </div>


        <div class="col-sm-12">
            {% module reply_panel(postinfo.uid, userinfo, en=True) %}
        </div>
    </div>
    <div class="panel-footer">
        <div class="row">
            <div class="col-md-12">
                <span>{{ _('Label') }}:</span>
                <span class="post_label">
                    {% module post_labels(post_uid = postinfo.uid) %}
                </span>
            </div>

        </div>
        <div class="row">
            <div class="col-md-12" id="bwlj">
                {{ _('Map link') }}： <a href="{% module site_url() %}/{{ kwd['router'] }}/{{ postinfo.uid }}"
                                        title="{{ postinfo.title }}">{{ postinfo.title }}</a>
            </div>
        </div>
    </div>
</div>


{% end %}

{% block right %}

<div class="panel panel-black">
    <div class="panel-heading"><b>{{ _('Map evaluation') }}</b></div>
    <div class="panel-body" style="font-size: x-small">
        {% module star_rating(postinfo, userinfo) %}
    </div>
</div>

<div class="panel panel-black">
    <div class="panel-heading"><b>{{ _('Correlation maps') }}</b></div>
    <ul class="list-group" style="overflow: hidden;">
        {% for x in relations %}
        <li class="list-group-item" style="overflow: hidden;">
            <a href="/{{ kwd['router'] }}/{{ x.post_id }}" title="{{ x.post_title }}">
                <span class="glyphicon glyphicon-globe"></span>{{ x.post_title }}

            </a>
        </li>
        {% end %}

    </ul>
</div>
<div class="panel panel-black">
    <div class="panel-heading"><b> {{ _('Recent maps') }} </b></div>
    <ul class="list-group">
        {% if userinfo is None %}
        {% module app_recent_used(postinfo.kind, num=5,glyph='glyphicon glyphicon-globe') %}
        {% else %}
        {% module app_recent_used(userinfo = userinfo, kind = postinfo.kind, num =5,glyph='glyphicon glyphicon-globe') %}
        {% end %}
    </ul>
</div>
<div class="panel panel-black">
    <div class="panel-heading">
        <b>
            {{ _('Mostly reviewed maps') }}
        </b>
    </div>
    <ul class="list-group">
        {% if userinfo is None %}
        {% module app_most_used(postinfo.kind, 5,glyph='glyphicon glyphicon-globe') %}
        {% else %}
        {% module app_user_most(userinfo.uid, postinfo.kind, 5,glyph='glyphicon glyphicon-globe') %}
        {% end %}
    </ul>
</div>


{% end %}
